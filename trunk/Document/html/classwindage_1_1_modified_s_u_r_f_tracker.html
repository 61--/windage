<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>windage library: windage::ModifiedSURFTracker Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><b>windage</b>::<a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html">ModifiedSURFTracker</a>
  </div>
</div>
<div class="contents">
<h1>windage::ModifiedSURFTracker Class Reference</h1><!-- doxytag: class="windage::ModifiedSURFTracker" --><!-- doxytag: inherits="windage::Tracker" -->
<p>Class for Camera <a class="el" href="classwindage_1_1_tracker.html" title="Abstract Class for Camera Tracker.">Tracker</a> using natural feature.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_modified_s_u_r_f_tracker_8h_source.html">ModifiedSURFTracker.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for windage::ModifiedSURFTracker:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker__inherit__graph.png" border="0" usemap="#windage_1_1_modified_s_u_r_f_tracker_inherit__map" alt="Inheritance graph"/></div>
<map name="windage_1_1_modified_s_u_r_f_tracker_inherit__map" id="windage_1_1_modified_s_u_r_f_tracker_inherit__map">
<area shape="rect" id="node2" href="classwindage_1_1_tracker.html" title="Abstract Class for Camera Tracker." alt="" coords="47,6,167,34"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for windage::ModifiedSURFTracker:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker__coll__graph.png" border="0" usemap="#windage_1_1_modified_s_u_r_f_tracker_coll__map" alt="Collaboration graph"/></div>
<map name="windage_1_1_modified_s_u_r_f_tracker_coll__map" id="windage_1_1_modified_s_u_r_f_tracker_coll__map">
<area shape="rect" id="node2" href="classwindage_1_1_tracker.html" title="Abstract Class for Camera Tracker." alt="" coords="13,99,133,127"/><area shape="rect" id="node4" href="classwindage_1_1_calibration.html" title="Class for Camera Parameter." alt="" coords="5,6,141,34"/><area shape="rect" id="node6" href="classwindage_1_1_optical_flow.html" title="Class for OpticalFlow." alt="" coords="157,99,301,127"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classwindage_1_1_modified_s_u_r_f_tracker-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7196d494430d3ba8892c216eb3efe83e"></a><!-- doxytag: member="windage::ModifiedSURFTracker::GetReferenceImage" ref="a7196d494430d3ba8892c216eb3efe83e" args="()" -->
IplImage *&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetReferenceImage</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a777d3bcb17a8e31a557f05e251d5d8b2"></a><!-- doxytag: member="windage::ModifiedSURFTracker::GetFeatureExtractTreshold" ref="a777d3bcb17a8e31a557f05e251d5d8b2" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>GetFeatureExtractTreshold</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a621bb3f158ed95e8de273716d7eb20dc"></a><!-- doxytag: member="windage::ModifiedSURFTracker::SetFeatureExtractTreshold" ref="a621bb3f158ed95e8de273716d7eb20dc" args="(int threshold=80)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>SetFeatureExtractTreshold</b> (int threshold=80)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a12a936d8b071b921018433d2232941ad">Initialize</a> (double fx, double fy, double cx, double cy, double d1, double d2, double d3, double d4, int featureExtractThreshold=100)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize ModifiedSURF <a class="el" href="classwindage_1_1_tracker.html" title="Abstract Class for Camera Tracker.">Tracker</a>.  <a href="#a12a936d8b071b921018433d2232941ad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#afe96b45dd2d674d529403a4963283145">RegistReferenceImage</a> (IplImage *referenceImage, double realWidth, double realHeight, double scaleFactor=4.0, int scaleStep=8)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">regist reference image  <a href="#afe96b45dd2d674d529403a4963283145"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a280141e72d9cb4abb7ec4a465cceb5c2">UpdateCameraPose</a> (IplImage *grayImage)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update Camera Pose (extrinsic parameter).  <a href="#a280141e72d9cb4abb7ec4a465cceb5c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a68d90209353b6aeec9efaee01e18468e">DrawDebugInfo</a> (IplImage *colorImage)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Draw Debug Information.  <a href="#a68d90209353b6aeec9efaee01e18468e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#aba3f0b6f2992df4d951d73354eded201">InitializeOpticalFlow</a> (int width, int height, int stepSize=10, CvSize windowSize=cvSize(10, 10), int pyramidLevel=3)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize <a class="el" href="classwindage_1_1_optical_flow.html" title="Class for OpticalFlow.">OpticalFlow</a>.  <a href="#aba3f0b6f2992df4d951d73354eded201"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a30467cf98f2c2cd29024a6fc0ced928c"></a><!-- doxytag: member="windage::ModifiedSURFTracker::SetOpticalFlowRunning" ref="a30467cf98f2c2cd29024a6fc0ced928c" args="(bool run)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>SetOpticalFlowRunning</b> (bool run)</td></tr>
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#aa55a0f9d300ade29e9b801306018900c">ExtractFASTCorner</a> (std::vector&lt; CvPoint &gt; *corners, IplImage *grayImage, int threshold, int n=9)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract FAST Corner.  <a href="#aa55a0f9d300ade29e9b801306018900c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a003040159db2b73666e4048d29da92e0">ExtractModifiedSURF</a> (IplImage *grayImage, std::vector&lt; CvPoint &gt; *corners, std::vector&lt; <a class="el" href="structwindage_1_1___s_u_r_f_description.html">SURFDesciription</a> &gt; *descriptions)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract ModifiedSURF.  <a href="#a003040159db2b73666e4048d29da92e0"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Class for Camera <a class="el" href="classwindage_1_1_tracker.html" title="Abstract Class for Camera Tracker.">Tracker</a> using natural feature. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>windage </dd></dl>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a68d90209353b6aeec9efaee01e18468e"></a><!-- doxytag: member="windage::ModifiedSURFTracker::DrawDebugInfo" ref="a68d90209353b6aeec9efaee01e18468e" args="(IplImage *colorImage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ModifiedSURFTracker::DrawDebugInfo </td>
          <td>(</td>
          <td class="paramtype">IplImage *&nbsp;</td>
          <td class="paramname"> <em>colorImage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Draw Debug Information. </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>draw debug information method </dd></dl>

<p>Implements <a class="el" href="classwindage_1_1_tracker.html#a883bf7db4d59924954d620d8beb4a681">windage::Tracker</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00633"></a>00633 {
<a name="l00634"></a>00634         <span class="keywordtype">int</span> pointCount = (int)sceneSURF.size();
<a name="l00635"></a>00635         <span class="keywordtype">int</span> r = 255;
<a name="l00636"></a>00636         <span class="keywordtype">int</span> g = 0;
<a name="l00637"></a>00637         <span class="keywordtype">int</span> b = 0;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639         <span class="keywordtype">int</span> size = 4;
<a name="l00640"></a>00640 <span class="comment">/*</span>
<a name="l00641"></a>00641 <span class="comment">        for(int i=0; i&lt;pointCount; i++)</span>
<a name="l00642"></a>00642 <span class="comment">        {</span>
<a name="l00643"></a>00643 <span class="comment">                r = 255 - 255 * (i/(double)pointCount);</span>
<a name="l00644"></a>00644 <span class="comment">                b = 255 * (i/(double)pointCount);</span>
<a name="l00645"></a>00645 <span class="comment">                cvCircle(colorImage, cvPoint(sceneSURF[i].point.x, sceneSURF[i].point.y), size, CV_RGB(r, g, b), 1);</span>
<a name="l00646"></a>00646 <span class="comment">        }</span>
<a name="l00647"></a>00647 <span class="comment">//*/</span>
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         CvScalar color = CV_RGB(255, 0, 255);
<a name="l00650"></a>00650         cvLine(colorImage, <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(0.0, 0.0, 0.0),                                                  <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(this-&gt;realWidth, 0.0, 0.0),                                 color, 2);
<a name="l00651"></a>00651         cvLine(colorImage, <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(this-&gt;realWidth, 0.0, 0.0),                              <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(this-&gt;realWidth, this-&gt;realHeight, 0.0),    color, 2);
<a name="l00652"></a>00652         cvLine(colorImage, <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(this-&gt;realWidth, this-&gt;realHeight, 0.0), <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(0.0, this-&gt;realHeight, 0.0),                                color, 2);
<a name="l00653"></a>00653         cvLine(colorImage, <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(0.0, this-&gt;realHeight, 0.0),                             <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(0.0, 0.0, 0.0),                                                             color, 2);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         cvLine(colorImage, <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(0.0, 0.0, 0.0),                                                  <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(this-&gt;realWidth, this-&gt;realHeight, 0.0),    color, 2);
<a name="l00656"></a>00656         cvLine(colorImage, <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(this-&gt;realWidth, 0.0, 0.0),                              <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;ConvertWorld2Image(0.0, this-&gt;realHeight, 0.0),                                color, 2);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;matchedScene.size(); i++)
<a name="l00659"></a>00659         {
<a name="l00660"></a>00660                 cvCircle(colorImage, cvPoint(matchedReference[i].point.x * colorImage-&gt;width/realWidth, (colorImage-&gt;height - matchedReference[i].point.y * colorImage-&gt;height/realHeight)), size, CV_RGB(0, 255, 255), CV_FILLED);
<a name="l00661"></a>00661                 cvCircle(colorImage, cvPoint(matchedScene[i].point.x, matchedScene[i].point.y), size, CV_RGB(255, 255, 0), CV_FILLED);
<a name="l00662"></a>00662                 cvLine(colorImage, cvPoint(matchedReference[i].point.x * colorImage-&gt;width/realWidth, (colorImage-&gt;height - matchedReference[i].point.y * colorImage-&gt;height/realHeight)), cvPoint(matchedScene[i].point.x, matchedScene[i].point.y), CV_RGB(255, 0, 0));
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa55a0f9d300ade29e9b801306018900c"></a><!-- doxytag: member="windage::ModifiedSURFTracker::ExtractFASTCorner" ref="aa55a0f9d300ade29e9b801306018900c" args="(std::vector&lt; CvPoint &gt; *corners, IplImage *grayImage, int threshold, int n=9)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ModifiedSURFTracker::ExtractFASTCorner </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; CvPoint &gt; *&nbsp;</td>
          <td class="paramname"> <em>corners</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IplImage *&nbsp;</td>
          <td class="paramname"> <em>grayImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em> = <code>9</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extract FAST Corner. </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>static method to extract fast corner points </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>corners</em>&nbsp;</td><td>output corner points </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>grayImage</em>&nbsp;</td><td>input image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>threshold</em>&nbsp;</td><td>FAST Corner threshold </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>n</em>&nbsp;</td><td>9 ~ 12 : continuous count </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116         <span class="keywordtype">int</span> cornerCount = 0;
<a name="l00117"></a>00117         xy* cornertemp = NULL;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         <span class="keywordtype">bool</span> isProcessed = <span class="keyword">true</span>;
<a name="l00120"></a>00120         <span class="keywordflow">switch</span>(n)
<a name="l00121"></a>00121         {
<a name="l00122"></a>00122         <span class="keywordflow">case</span> 9:
<a name="l00123"></a>00123                 cornertemp = fast_corner_detect_9((<span class="keyword">const</span> byte *)grayImage-&gt;imageData, grayImage-&gt;width, grayImage-&gt;height, threshold, &amp;cornerCount);
<a name="l00124"></a>00124                 <span class="keywordflow">break</span>;
<a name="l00125"></a>00125         <span class="keywordflow">case</span> 10:
<a name="l00126"></a>00126                 cornertemp = fast_corner_detect_10((<span class="keyword">const</span> byte *)grayImage-&gt;imageData, grayImage-&gt;width, grayImage-&gt;height, threshold, &amp;cornerCount);
<a name="l00127"></a>00127                 <span class="keywordflow">break</span>;
<a name="l00128"></a>00128         <span class="keywordflow">case</span> 11:
<a name="l00129"></a>00129                 cornertemp = fast_corner_detect_11((<span class="keyword">const</span> byte *)grayImage-&gt;imageData, grayImage-&gt;width, grayImage-&gt;height, threshold, &amp;cornerCount);
<a name="l00130"></a>00130                 <span class="keywordflow">break</span>;
<a name="l00131"></a>00131         <span class="keywordflow">case</span> 12 :
<a name="l00132"></a>00132                 cornertemp = fast_corner_detect_12((<span class="keyword">const</span> byte *)grayImage-&gt;imageData, grayImage-&gt;width, grayImage-&gt;height, threshold, &amp;cornerCount);
<a name="l00133"></a>00133                 <span class="keywordflow">break</span>;
<a name="l00134"></a>00134         <span class="keywordflow">default</span>:
<a name="l00135"></a>00135                 isProcessed = <span class="keyword">false</span>;
<a name="l00136"></a>00136                 <span class="keywordflow">break</span>;
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="keywordflow">if</span>(isProcessed)
<a name="l00140"></a>00140         {
<a name="l00141"></a>00141                 <span class="keywordtype">int</span> count = 0;
<a name="l00142"></a>00142                 xy* nonmax = NULL;
<a name="l00143"></a>00143                 nonmax = fast_nonmax((<span class="keyword">const</span> byte *)grayImage-&gt;imageData, grayImage-&gt;width, grayImage-&gt;height, cornertemp, cornerCount, threshold, &amp;count);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;count; ++i)
<a name="l00146"></a>00146                 {
<a name="l00147"></a>00147                         corners-&gt;push_back(cvPoint(nonmax[i].x, nonmax[i].y));
<a name="l00148"></a>00148                 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150                 <span class="keywordflow">if</span>(nonmax) <span class="keyword">delete</span> nonmax;
<a name="l00151"></a>00151                 <span class="keywordflow">if</span>(cornertemp) <span class="keyword">delete</span> cornertemp;
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)corners-&gt;size();
<a name="l00155"></a>00155 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker_aa55a0f9d300ade29e9b801306018900c_icgraph.png" border="0" usemap="#classwindage_1_1_modified_s_u_r_f_tracker_aa55a0f9d300ade29e9b801306018900c_icgraph_map" alt=""></div>
<map name="classwindage_1_1_modified_s_u_r_f_tracker_aa55a0f9d300ade29e9b801306018900c_icgraph_map" id="classwindage_1_1_modified_s_u_r_f_tracker_aa55a0f9d300ade29e9b801306018900c_icgraph">
<area shape="rect" id="node3" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a280141e72d9cb4abb7ec4a465cceb5c2" title="Update Camera Pose (extrinsic parameter)." alt="" coords="380,5,705,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a003040159db2b73666e4048d29da92e0"></a><!-- doxytag: member="windage::ModifiedSURFTracker::ExtractModifiedSURF" ref="a003040159db2b73666e4048d29da92e0" args="(IplImage *grayImage, std::vector&lt; CvPoint &gt; *corners, std::vector&lt; SURFDesciription &gt; *descriptions)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ModifiedSURFTracker::ExtractModifiedSURF </td>
          <td>(</td>
          <td class="paramtype">IplImage *&nbsp;</td>
          <td class="paramname"> <em>grayImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; CvPoint &gt; *&nbsp;</td>
          <td class="paramname"> <em>corners</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structwindage_1_1___s_u_r_f_description.html">SURFDesciription</a> &gt; *&nbsp;</td>
          <td class="paramname"> <em>descriptions</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extract ModifiedSURF. </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>static method to generate modified surf descriptor using input points </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>grayImage</em>&nbsp;</td><td>input image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>corners</em>&nbsp;</td><td>input corners </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>descriptions</em>&nbsp;</td><td>output descriptors </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00158"></a>00158 {
<a name="l00159"></a>00159         CvSURFParams params = cvSURFParams(500, 0);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         CvMemStorage* storage = cvCreateMemStorage(0);
<a name="l00162"></a>00162         CvSeq *referenceKeypoints = 0, *referenceDescriptors = 0;
<a name="l00163"></a>00163 <span class="comment">//      cvExtractSURF(image, 0, &amp;referenceKeypoints, &amp;referenceDescriptors, storage, params );</span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">//      std::vector&lt;CvPoint&gt; fastCorners;</span>
<a name="l00166"></a>00166 <span class="comment">//      ExtractFASTCorner(&amp;fastCorners, grayImage, thresholdFAST);</span>
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         referenceKeypoints = cvCreateSeq( 0, <span class="keyword">sizeof</span>(CvSeq), <span class="keyword">sizeof</span>(CvSURFPoint), storage );
<a name="l00169"></a>00169         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;(*corners).size(); i++)
<a name="l00170"></a>00170         {
<a name="l00171"></a>00171                 CvSURFPoint point = cvSURFPoint( cvPoint2D32f((*corners)[i].x, (*corners)[i].y), 0, 15, 0, 0);
<a name="l00172"></a>00172                 cvSeqPush(referenceKeypoints, &amp;point);
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174         wExtractSURF(grayImage, 0, &amp;referenceKeypoints, &amp;referenceDescriptors, storage, params, 1);
<a name="l00175"></a>00175 <span class="comment">//      cvExtractSURF(grayImage, 0, &amp;referenceKeypoints, &amp;referenceDescriptors, storage, params, 1);</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         CvSeqReader reader;
<a name="l00178"></a>00178         cvStartReadSeq( referenceDescriptors, &amp;reader, 0 );
<a name="l00179"></a>00179         <span class="keywordtype">int</span> length = (int)(referenceDescriptors-&gt;elem_size/<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00180"></a>00180         <span class="keywordtype">int</span> count = referenceKeypoints-&gt;total;
<a name="l00181"></a>00181         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;count; i++ )
<a name="l00182"></a>00182         {
<a name="l00183"></a>00183                 <a class="code" href="structwindage_1_1___s_u_r_f_description.html" title="structor of SURF Description">SURFDesciription</a> description;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185                 CvSURFPoint* r = (CvSURFPoint*)cvGetSeqElem( referenceKeypoints, i );
<a name="l00186"></a>00186                 description.<a class="code" href="structwindage_1_1___s_u_r_f_description.html#a57ede1868ae527f2ee6aaa43ef286e8f" title="extract point">point</a> = r-&gt;pt;
<a name="l00187"></a>00187                 description.<a class="code" href="structwindage_1_1___s_u_r_f_description.html#a09c8a699004ba230c4ba95aa882aec7c" title="scale value">size</a> = r-&gt;size;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                 <span class="keywordtype">float</span>* vec = (<span class="keywordtype">float</span>*)reader.ptr;
<a name="l00190"></a>00190                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;length; i++)
<a name="l00191"></a>00191                 {
<a name="l00192"></a>00192                         description.<a class="code" href="structwindage_1_1___s_u_r_f_description.html#a52d9f13936823df606168b1e3641eb0e" title="SURF Descriptor 36-dimension.">descriptor</a>[i] = vec[i];
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195                 descriptions-&gt;push_back(description);
<a name="l00196"></a>00196                 CV_NEXT_SEQ_ELEM( reader.seq-&gt;elem_size, reader );
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         cvReleaseMemStorage(&amp;storage);
<a name="l00200"></a>00200         <span class="keywordflow">return</span> count;
<a name="l00201"></a>00201 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker_a003040159db2b73666e4048d29da92e0_icgraph.png" border="0" usemap="#classwindage_1_1_modified_s_u_r_f_tracker_a003040159db2b73666e4048d29da92e0_icgraph_map" alt=""></div>
<map name="classwindage_1_1_modified_s_u_r_f_tracker_a003040159db2b73666e4048d29da92e0_icgraph_map" id="classwindage_1_1_modified_s_u_r_f_tracker_a003040159db2b73666e4048d29da92e0_icgraph">
<area shape="rect" id="node3" href="classwindage_1_1_stereo_s_u_r_f_detector.html#a59ad2932eaef3a3874a9797f2db93781" title="Get Disparity." alt="" coords="415,5,692,33"/><area shape="rect" id="node7" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a280141e72d9cb4abb7ec4a465cceb5c2" title="Update Camera Pose (extrinsic parameter)." alt="" coords="391,55,716,83"/><area shape="rect" id="node5" href="classwindage_1_1_stereo_s_u_r_f_detector.html#aa9854d4188e1d95fcd0d82d727a5d509" title="Calculate Activation." alt="" coords="767,5,1081,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a12a936d8b071b921018433d2232941ad"></a><!-- doxytag: member="windage::ModifiedSURFTracker::Initialize" ref="a12a936d8b071b921018433d2232941ad" args="(double fx, double fy, double cx, double cy, double d1, double d2, double d3, double d4, int featureExtractThreshold=100)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ModifiedSURFTracker::Initialize </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>fx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>fy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>d1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>d2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>d3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>d4</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>featureExtractThreshold</em> = <code>100</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize ModifiedSURF <a class="el" href="classwindage_1_1_tracker.html" title="Abstract Class for Camera Tracker.">Tracker</a>. </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>initialize ModifiedSURF tracker setting FAST corner threshold and camera paramter (intrinsic parameter) </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fx</em>&nbsp;</td><td>intrinsic parameter x focal length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fy</em>&nbsp;</td><td>intrinsic parameter y focal length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cx</em>&nbsp;</td><td>intrinsic parameter x principle point </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cy</em>&nbsp;</td><td>intrinsic parameter y principle point </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>d1</em>&nbsp;</td><td>intrinsic parameter distortion factor1 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>d2</em>&nbsp;</td><td>intrinsic parameter distortion factor2 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>d3</em>&nbsp;</td><td>intrinsic parameter distortion factor3 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>d4</em>&nbsp;</td><td>intrinsic parameter distortion factor4 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>featureExtractThreshold</em>&nbsp;</td><td>FAST corner extract threshold </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084 {
<a name="l00085"></a>00085         this-&gt;Release();
<a name="l00086"></a>00086         <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a> = <span class="keyword">new</span> <a class="code" href="classwindage_1_1_calibration.html" title="Class for Camera Parameter.">Calibration</a>();
<a name="l00087"></a>00087         <a class="code" href="classwindage_1_1_tracker.html#a59c25e052eddd80158910549bea09eb8" title="camera parameter">cameraParameter</a>-&gt;<a class="code" href="classwindage_1_1_calibration.html#a44336c79c53619c530944f353cc2073a" title="initialize camera paramter (intrinsic parameter)">Initialize</a>(fx, fy, cx, cy, d1, d2, d3, d4);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         this-&gt;SetFeatureExtractTreshold(featureExtractThreshold);
<a name="l00090"></a>00090 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker_a12a936d8b071b921018433d2232941ad_cgraph.png" border="0" usemap="#classwindage_1_1_modified_s_u_r_f_tracker_a12a936d8b071b921018433d2232941ad_cgraph_map" alt=""></div>
<map name="classwindage_1_1_modified_s_u_r_f_tracker_a12a936d8b071b921018433d2232941ad_cgraph_map" id="classwindage_1_1_modified_s_u_r_f_tracker_a12a936d8b071b921018433d2232941ad_cgraph">
<area shape="rect" id="node3" href="classwindage_1_1_calibration.html#a44336c79c53619c530944f353cc2073a" title="initialize camera paramter (intrinsic parameter)" alt="" coords="312,5,504,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aba3f0b6f2992df4d951d73354eded201"></a><!-- doxytag: member="windage::ModifiedSURFTracker::InitializeOpticalFlow" ref="aba3f0b6f2992df4d951d73354eded201" args="(int width, int height, int stepSize=10, CvSize windowSize=cvSize(10, 10), int pyramidLevel=3)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ModifiedSURFTracker::InitializeOpticalFlow </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stepSize</em> = <code>10</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CvSize&nbsp;</td>
          <td class="paramname"> <em>windowSize</em> = <code>cvSize(10,&nbsp;10)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pyramidLevel</em> = <code>3</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize <a class="el" href="classwindage_1_1_optical_flow.html" title="Class for OpticalFlow.">OpticalFlow</a>. </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>initialize <a class="el" href="classwindage_1_1_optical_flow.html" title="Class for OpticalFlow.">OpticalFlow</a> setting pyramid level and window size running opticalflow after initialization </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>width</em>&nbsp;</td><td>input image width size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>height</em>&nbsp;</td><td>input image height size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stepSize</em>&nbsp;</td><td>calling time to recognize object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>windowSize</em>&nbsp;</td><td>opticalflow window size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pyramidLevel</em>&nbsp;</td><td>opticalflow pyramid level </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00668"></a>00668 {
<a name="l00669"></a>00669         <span class="keywordflow">if</span>(opticalflow) <span class="keyword">delete</span> opticalflow;
<a name="l00670"></a>00670         opticalflow = <span class="keyword">new</span> <a class="code" href="classwindage_1_1_optical_flow.html" title="Class for OpticalFlow.">OpticalFlow</a>();
<a name="l00671"></a>00671         opticalflow-&gt;<a class="code" href="classwindage_1_1_optical_flow.html#a07b08f7792c61e9a2f2b0bf085b83626" title="Initialize OpticalFlow.">Initialize</a>(width, height, windowSize, pyramidLevel);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673         runOpticalflow = <span class="keyword">true</span>;
<a name="l00674"></a>00674         this-&gt;stepSize = stepSize;
<a name="l00675"></a>00675         this-&gt;step = stepSize + 1;
<a name="l00676"></a>00676 }</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker_aba3f0b6f2992df4d951d73354eded201_cgraph.png" border="0" usemap="#classwindage_1_1_modified_s_u_r_f_tracker_aba3f0b6f2992df4d951d73354eded201_cgraph_map" alt=""></div>
<map name="classwindage_1_1_modified_s_u_r_f_tracker_aba3f0b6f2992df4d951d73354eded201_cgraph_map" id="classwindage_1_1_modified_s_u_r_f_tracker_aba3f0b6f2992df4d951d73354eded201_cgraph">
<area shape="rect" id="node3" href="classwindage_1_1_optical_flow.html#a07b08f7792c61e9a2f2b0bf085b83626" title="Initialize OpticalFlow." alt="" coords="379,5,579,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afe96b45dd2d674d529403a4963283145"></a><!-- doxytag: member="windage::ModifiedSURFTracker::RegistReferenceImage" ref="afe96b45dd2d674d529403a4963283145" args="(IplImage *referenceImage, double realWidth, double realHeight, double scaleFactor=4.0, int scaleStep=8)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ModifiedSURFTracker::RegistReferenceImage </td>
          <td>(</td>
          <td class="paramtype">IplImage *&nbsp;</td>
          <td class="paramname"> <em>referenceImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>realWidth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>realHeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>scaleFactor</em> = <code>4.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>scaleStep</em> = <code>8</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>regist reference image </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>regist reference image </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>referenceImage</em>&nbsp;</td><td>reference image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>realWidth</em>&nbsp;</td><td>image real width size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>realHeight</em>&nbsp;</td><td>image real width size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>scaleFactor</em>&nbsp;</td><td>scale factor for multi-scale </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>scaleStep</em>&nbsp;</td><td>multi-scale step </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00093"></a>00093 {
<a name="l00094"></a>00094         <span class="comment">// delete previous reference data</span>
<a name="l00095"></a>00095         <span class="keywordflow">if</span>(referenceImage) cvReleaseImage(&amp;this-&gt;referenceImage);
<a name="l00096"></a>00096         this-&gt;referenceImage = NULL;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">if</span>(referenceFeatureStorage) cvReleaseMat(&amp;referenceFeatureStorage);
<a name="l00099"></a>00099         referenceFeatureStorage = NULL;
<a name="l00100"></a>00100         <span class="keywordflow">if</span>(referenceFeatureTree) cvReleaseFeatureTree(referenceFeatureTree);
<a name="l00101"></a>00101         referenceFeatureTree = NULL;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103         <span class="comment">// registrate</span>
<a name="l00104"></a>00104         this-&gt;referenceImage = cvCloneImage(referenceImage);
<a name="l00105"></a>00105         cvSmooth(this-&gt;referenceImage, this-&gt;referenceImage, CV_GAUSSIAN, 3, 3, 0.5, 0.5);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         this-&gt;realWidth = realWidth;
<a name="l00108"></a>00108         this-&gt;realHeight = realHeight;
<a name="l00109"></a>00109         this-&gt;SetFeatureExtractTreshold(featureExtractThreshold);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         GenerateReferenceFeatureTree(scaleFactor, scaleStep);
<a name="l00112"></a>00112 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a280141e72d9cb4abb7ec4a465cceb5c2"></a><!-- doxytag: member="windage::ModifiedSURFTracker::UpdateCameraPose" ref="a280141e72d9cb4abb7ec4a465cceb5c2" args="(IplImage *grayImage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ModifiedSURFTracker::UpdateCameraPose </td>
          <td>(</td>
          <td class="paramtype">IplImage *&nbsp;</td>
          <td class="paramname"> <em>grayImage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update Camera Pose (extrinsic parameter). </p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>update extrinsic parameter method using input image </dd></dl>

<p>Implements <a class="el" href="classwindage_1_1_tracker.html#a62b9bf81272b9eb44d8333aae43af088">windage::Tracker</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00512"></a>00512 {
<a name="l00513"></a>00513         <span class="keywordtype">bool</span> update = <span class="keyword">true</span>;
<a name="l00514"></a>00514         <span class="keywordflow">if</span>(runOpticalflow)
<a name="l00515"></a>00515         {
<a name="l00516"></a>00516                 <span class="keywordflow">if</span>(step &gt; stepSize)
<a name="l00517"></a>00517                 {
<a name="l00518"></a>00518 <span class="comment">//                      update = false;</span>
<a name="l00519"></a>00519 
<a name="l00520"></a>00520                         std::vector&lt;CvPoint2D32f&gt; matchedTempPoints;
<a name="l00521"></a>00521                         opticalflow-&gt;<a class="code" href="classwindage_1_1_optical_flow.html#a15271241105366926e6293e156834222" title="Tracking Feature using OpticalFlow.">TrackFeature</a>(grayImage, &amp;matchedScenePoints, &amp;matchedTempPoints);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523                         <span class="keywordtype">int</span> index = 0;
<a name="l00524"></a>00524                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;matchedTempPoints.size(); i++)
<a name="l00525"></a>00525                         {
<a name="l00526"></a>00526                                 <span class="keywordflow">if</span>(matchedTempPoints[i].x &gt;= 0 &amp;&amp; matchedTempPoints[i].y &gt;= 0)
<a name="l00527"></a>00527                                 {
<a name="l00528"></a>00528                                         matchedScene[index].point = matchedTempPoints[i];
<a name="l00529"></a>00529                                         index++;
<a name="l00530"></a>00530                                 }
<a name="l00531"></a>00531                                 <span class="keywordflow">else</span>
<a name="l00532"></a>00532                                 {
<a name="l00533"></a>00533                                         matchedReference.erase(matchedReference.begin() + index);
<a name="l00534"></a>00534                                         matchedScene.erase(matchedScene.begin() + index);
<a name="l00535"></a>00535                                 }
<a name="l00536"></a>00536                         }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538                         <span class="comment">// add feature</span>
<a name="l00539"></a>00539                         sceneSURF.clear();
<a name="l00540"></a>00540                         std::vector&lt;CvPoint&gt; fastCorners;
<a name="l00541"></a>00541                         <a class="code" href="classwindage_1_1_modified_s_u_r_f_tracker.html#aa55a0f9d300ade29e9b801306018900c" title="Extract FAST Corner.">ModifiedSURFTracker::ExtractFASTCorner</a>(&amp;fastCorners, grayImage, featureExtractThreshold);
<a name="l00542"></a>00542                         <span class="keywordtype">int</span> featureCount = <a class="code" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a003040159db2b73666e4048d29da92e0" title="Extract ModifiedSURF.">ModifiedSURFTracker::ExtractModifiedSURF</a>(grayImage, &amp;fastCorners, &amp;sceneSURF);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544                         std::vector&lt;SURFDesciription&gt; tempReferenceSURF;
<a name="l00545"></a>00545                         std::vector&lt;SURFDesciription&gt; tempSceneSURF;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;sceneSURF.size(); i++)
<a name="l00548"></a>00548                         {
<a name="l00549"></a>00549                                 <span class="keywordtype">int</span> index = FindPairs(sceneSURF[i], referenceFeatureTree);
<a name="l00550"></a>00550                                 <span class="keywordflow">if</span>(index &gt; 0)
<a name="l00551"></a>00551                                 {
<a name="l00552"></a>00552                                         tempReferenceSURF.push_back(referenceSURF[index]);
<a name="l00553"></a>00553                                         tempSceneSURF.push_back(sceneSURF[i]);
<a name="l00554"></a>00554                                 }
<a name="l00555"></a>00555                         }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;tempReferenceSURF.size(); i++)
<a name="l00558"></a>00558                         {
<a name="l00559"></a>00559                                 <span class="keywordtype">bool</span> isFound = <span class="keyword">false</span>;
<a name="l00560"></a>00560                                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;matchedReference.size()&amp;&amp;!isFound; j++)
<a name="l00561"></a>00561                                 {
<a name="l00562"></a>00562                                         <span class="keywordflow">if</span>( abs(tempReferenceSURF[i].point.x - matchedReference[j].point.x) +
<a name="l00563"></a>00563                                                 abs(tempReferenceSURF[i].point.y - matchedReference[j].point.y) &lt; 0.5)
<a name="l00564"></a>00564                                         {
<a name="l00565"></a>00565                                                 isFound = <span class="keyword">true</span>;
<a name="l00566"></a>00566                                         }
<a name="l00567"></a>00567                                 }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569                                 <span class="keywordflow">if</span>(!isFound)
<a name="l00570"></a>00570                                 {
<a name="l00571"></a>00571                                         matchedReference.push_back(tempReferenceSURF[i]);
<a name="l00572"></a>00572                                         matchedScene.push_back(tempSceneSURF[i]);
<a name="l00573"></a>00573                                 }
<a name="l00574"></a>00574                         }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                         step = 0;
<a name="l00577"></a>00577                 }
<a name="l00578"></a>00578                 <span class="keywordflow">else</span>
<a name="l00579"></a>00579                 {
<a name="l00580"></a>00580                         std::vector&lt;CvPoint2D32f&gt; matchedTempPoints;
<a name="l00581"></a>00581                         opticalflow-&gt;<a class="code" href="classwindage_1_1_optical_flow.html#a15271241105366926e6293e156834222" title="Tracking Feature using OpticalFlow.">TrackFeature</a>(grayImage, &amp;matchedScenePoints, &amp;matchedTempPoints);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                         <span class="keywordtype">int</span> index = 0;
<a name="l00584"></a>00584                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;matchedTempPoints.size(); i++)
<a name="l00585"></a>00585                         {
<a name="l00586"></a>00586                                 <span class="keywordflow">if</span>(matchedTempPoints[i].x &gt;= 0 &amp;&amp; matchedTempPoints[i].y &gt;= 0)
<a name="l00587"></a>00587                                 {
<a name="l00588"></a>00588                                         matchedScene[index].point = matchedTempPoints[i];
<a name="l00589"></a>00589                                         index++;
<a name="l00590"></a>00590                                 }
<a name="l00591"></a>00591                                 <span class="keywordflow">else</span>
<a name="l00592"></a>00592                                 {
<a name="l00593"></a>00593                                         matchedReference.erase(matchedReference.begin() + index);
<a name="l00594"></a>00594                                         matchedScene.erase(matchedScene.begin() + index);
<a name="l00595"></a>00595                                 }
<a name="l00596"></a>00596                         }
<a name="l00597"></a>00597                 }
<a name="l00598"></a>00598                 step++;
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         <span class="keywordflow">else</span>
<a name="l00601"></a>00601         {
<a name="l00602"></a>00602                 sceneSURF.clear();
<a name="l00603"></a>00603                 std::vector&lt;CvPoint&gt; fastCorners;
<a name="l00604"></a>00604                 <a class="code" href="classwindage_1_1_modified_s_u_r_f_tracker.html#aa55a0f9d300ade29e9b801306018900c" title="Extract FAST Corner.">ModifiedSURFTracker::ExtractFASTCorner</a>(&amp;fastCorners, grayImage, featureExtractThreshold);
<a name="l00605"></a>00605                 <span class="keywordtype">int</span> featureCount = <a class="code" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a003040159db2b73666e4048d29da92e0" title="Extract ModifiedSURF.">ModifiedSURFTracker::ExtractModifiedSURF</a>(grayImage, &amp;fastCorners, &amp;sceneSURF);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607                 matchedReference.clear();
<a name="l00608"></a>00608                 matchedScene.clear();
<a name="l00609"></a>00609                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;sceneSURF.size(); i++)
<a name="l00610"></a>00610                 {
<a name="l00611"></a>00611                         <span class="keywordtype">int</span> index = FindPairs(sceneSURF[i], referenceFeatureTree);
<a name="l00612"></a>00612                         <span class="keywordflow">if</span>(index &gt; 0)
<a name="l00613"></a>00613                         {
<a name="l00614"></a>00614                                 matchedReference.push_back(referenceSURF[index]);
<a name="l00615"></a>00615                                 matchedScene.push_back(sceneSURF[i]);
<a name="l00616"></a>00616                         }
<a name="l00617"></a>00617                 }
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620         matchedReferencePoints.clear();
<a name="l00621"></a>00621         matchedScenePoints.clear();
<a name="l00622"></a>00622         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;matchedScene.size(); i++)
<a name="l00623"></a>00623         {
<a name="l00624"></a>00624                 matchedReferencePoints.push_back(matchedReference[i].point);
<a name="l00625"></a>00625                 matchedScenePoints.push_back(matchedScene[i].point);
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627         this-&gt;CalculatePose(update);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)matchedScenePoints.size();
<a name="l00630"></a>00630 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classwindage_1_1_modified_s_u_r_f_tracker_a280141e72d9cb4abb7ec4a465cceb5c2_cgraph.png" border="0" usemap="#classwindage_1_1_modified_s_u_r_f_tracker_a280141e72d9cb4abb7ec4a465cceb5c2_cgraph_map" alt=""></div>
<map name="classwindage_1_1_modified_s_u_r_f_tracker_a280141e72d9cb4abb7ec4a465cceb5c2_cgraph_map" id="classwindage_1_1_modified_s_u_r_f_tracker_a280141e72d9cb4abb7ec4a465cceb5c2_cgraph">
<area shape="rect" id="node3" href="classwindage_1_1_modified_s_u_r_f_tracker.html#aa55a0f9d300ade29e9b801306018900c" title="Extract FAST Corner." alt="" coords="388,5,711,33"/><area shape="rect" id="node5" href="classwindage_1_1_modified_s_u_r_f_tracker.html#a003040159db2b73666e4048d29da92e0" title="Extract ModifiedSURF." alt="" coords="381,55,717,83"/><area shape="rect" id="node7" href="classwindage_1_1_optical_flow.html#a15271241105366926e6293e156834222" title="Tracking Feature using OpticalFlow." alt="" coords="436,106,663,134"/></map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>D:/Workspace/2009. Fall/Workspace/SpatialInteraction/source/windageLib/windage/Tracker/<a class="el" href="_modified_s_u_r_f_tracker_8h_source.html">ModifiedSURFTracker.h</a></li>
<li>D:/Workspace/2009. Fall/Workspace/SpatialInteraction/source/windageLib/windage/Tracker/ModifiedSURFTracker.cpp</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Fri Aug 28 02:30:53 2009 for windage library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
